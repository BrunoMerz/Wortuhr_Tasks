<!doctype html>
<html><head>
<title>Événement</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<link rel="icon" type="image/png" sizes="192x192"  href="/web/android-icon-192x192.png">
<script src="/web/jquery-3.1.1.min.js"></script>
<link rel="stylesheet" href="/web/events.css" >
</head>
<body>

<h2> Événements </h2>
<hr>

  <form class="form-horizontal" id="form" action="/handleevents" method="POST">
  <div id="oben"></div>
  <div class="buttonscontainer">
  <table border="0" cellspacing="0" cellpadding="0" width="99%">
  <tr>
  <td align="left" style="width:33%">
    <button class="buttons" type="button" id="eventadd" >&#10024; nouveau</button>
  </td>
  <td align="middle" style="width:33%">
    <button class="buttons" name="_action" value="0">&#128281; précédent</button>
  </td>
  <td align="right" style="width:33%">
    <button class="buttons" name="_action" value="1">&#128077; sauvegarder</button>
  </td>
  </tr>
  </table>
  </div>
  </form>

  <div id="templates" style="display: none">
    <div id="eventTemplate">
	<table>
    <tr>
	  <td>Texte:
	  </td>
      <td>
	  <dfn class ="tooltip">
	    <input type ="text" id="t" name="t" size="29" maxlength="50" value="">
		<span role="tooltip"> est remplacé  <br> par l’âge</span>
	  </dfn>
	  </td>
    </tr>
	<tr>
	  <td>Date:
	  </td>
	  <td>
	    <input type="date" id="d" name="d" value="0001-01-01">
    </td>
  </tr>
	<tr>
	  <td>Start:
	  </td>
    <td>
      <input type="radio" id="s1" name="s" value="1" checked>
      <label  for="s1">à la date</label>
    
      <input type="radio" id="s2" name="s" value="2" >
      <label  for="s2">tous les jours</label>
    
      <input type="radio" id="s3" name="s" value="3" >
      <label  for="s3">jamais</label>
    </td>
  </tr>
	<tr>
	<td>Couleur du texte:
	</td>
	<td>
	  <input type="color" id= "c" name="c" value="#ffffff" size="1">
	</td>
    </tr>
    <tr>
	<td>AudioFile:
	</td>
    <td>
	<dfn class ="tooltip">
	<input type ="number" id="a" name="a" min="710" max="999" value=710>
    <span role="tooltip">710-719:Weihnachtsmelodien <br> 720-726:Geburtstagslieder <br> 730-733:Silvester/Neujahr </span>
	</dfn>
	</td>
    </tr>
    <tr>
	<td>Animation avant:
	  </td>
      <td>
	    <select style="width:220px" id= "v" name="v" size="1">
		  <option id="keinevoption" value="KEINE">Aucun</option>
		</select>
	  </td>
    </tr>
	<tr>
	<td>Animation par la suite:
	  </td>
      <td>
	  	<select style="width:220px" id= "n" name="n" size="1">
		  <option id="keinenoption" value="KEINE">Aucun</option>
		</select>
	  </td>
    </tr>
	<tr>
	<td>Intervalle:
	</td>
    <td>
	<input type ="number" id="i" name="i" min="5" max="1440" value=120>
	<label> Minutes</label>
	</td>
    </tr>
	</table>
	<button class="buttons" type="button" id="eventdel">&#128465 enlever</button>
	<hr>
    </div>
  </div>
<hr>



<script> 
var eventnummer = 0;
var anzevents = 0;
var maxevents = 0;
const colorArray =
[
	0xFFFFFF, // 00 WHITE
	0xFFFF80, // 01 YELLOW_50
	0xFFFF40, // 02 YELLOW_25
	0xFFFF00, // 03 YELLOW
	0xFF80FF, // 04 MAGENTA_50
	0xFF8080, // 05 RED_50
	0xFF7000, // 06 ORANGE
	0xFF40FF, // 07 MAGENTA_25
	0xFF4040, // 08 RED_25
	0xFF00FF, // 09 MAGENTA
	0xFF007F, // 10 PINK
	0xFF0000, // 11 RED
	0x80FFFF, // 12 CYAN_50
	0x80FF80, // 13 GREEN_50
	0x8080FF, // 14 BLUE_50
	0x7FFF00, // 15 GREENYELLOW
	0x7F00FF, // 16 VIOLET
	0x40FFFF, // 17 CYAN_25
	0x40FF40, // 18 GREEN_25
	0x4040FF, // 19 BLUE_25
	0x0F0FFF, // 20 BLUE
	0x00FFFF, // 21 CYAN
	0x00FF7F, // 22 MINTGREEN
	0x00FF00, // 23 GREEN
	0x007FFF, // 24 LIGHTBLUE
	0x000000, // 25 RAINBOW
];

function intToRGB(intValue) {
    var hexColor = (intValue & 0x00FFFFFF).toString(16); // Masking with 0x00FFFFFF to ensure a six-digit hex value
    return '#' + ('000000' + hexColor).slice(-6); // Padding the string to ensure a six-digit hex color
}

$.getJSON( "/animationsliste.json", function( aniliste ) {
  for (i in aniliste.Animationsliste) {
    var vorani = $("#keinevoption").clone()
	vorani.attr("id", "ev");
	vorani.attr("value",aniliste.Animationsliste[i]);
	vorani.text(aniliste.Animationsliste[i]);
	$(vorani).appendTo( "#v" );
    var nachani = $("#keinenoption").clone()
	nachani.attr("id", "en");
	nachani.attr("value",aniliste.Animationsliste[i]);
	nachani.text(aniliste.Animationsliste[i]);
	$(nachani).appendTo( "#n" );	
  }
 });
 
  $.getJSON( "/events.json", function( myObj ) {
  maxevents = myObj.maxevents;
  var evnr = 0;
  //console.log(myObj);
  for (evnr in myObj.events) {
  	anzevents++;
  	if ( anzevents >= maxevents ) $("#eventadd").hide();
	  addevent(evnr);
  }
  
  eventnummer = parseInt(evnr) + 1;
  //console.log("eventnummer:" + eventnummer);
  
function addevent(eventnr)
{
  var template = $("#eventTemplate").clone();
  template.attr("id", "event_group_" + eventnr);
// eventtext
  var eventtext = template.find("#t");
  eventtext.attr("id","t" + eventnr);
  eventtext.attr("name","t" + eventnr);
  eventtext.attr("value",myObj.events[eventnr].text);
// eventdatum
  var eventdatum = template.find("#d");
  eventdatum.attr("id","d" + eventnr);
  eventdatum.attr("name","d" + eventnr);
  var pad4 = "0000";
  var jahr = myObj.events[eventnr].jahr + "";
  var jahr4 = pad4.substring(0, 4 - jahr.length) + jahr;
  var pad2 = "00";
  var monat = myObj.events[eventnr].monat + "";
  var monat2 = pad2.substring(0, 2 - monat.length) + monat;
  var tag = myObj.events[eventnr].tag + "";
  var tag2 = pad2.substring(0, 2 - tag.length) + tag;
//  console.log(jahr4 + "-" + monat2+"-"+tag2);
  eventdatum.attr("value",jahr4 +"-"+monat2+"-"+tag2);

// event start
  //console.log("nr="+eventnr+", value="+myObj.events[eventnr].start);
  var eventstart1 = template.find('#s1');
  eventstart1.attr("id","s1" + eventnr);
  eventstart1.attr("name","s" + eventnr);
  
  var eventstart2 = template.find('#s2');
  eventstart2.attr("id","s2" + eventnr);
  eventstart2.attr("name","s" + eventnr);

  var eventstart3 = template.find('#s3');
  eventstart3.attr("id","s3" + eventnr);
  eventstart3.attr("name","s" + eventnr);
  switch(myObj.events[eventnr].start) {
    case 2:
      eventstart2.attr("checked",true);
      break;
    case 3:
      eventstart3.attr("checked",true);
      break;
    default:
      eventstart1.attr("checked",true);
      break;
  }

// eventcolor
  var eventcolor = template.find("#c");
  eventcolor.attr("id","c" + eventnr);
  eventcolor.attr("name","c" + eventnr);
  if(myObj.events[eventnr].farbe < 26)
    myObj.events[eventnr].farbe = colorArray[myObj.events[eventnr].farbe];
  eventcolor.attr("value",intToRGB(myObj.events[eventnr].farbe));

// eventaudio
  var eventaudio = template.find("#a");
  eventaudio.attr("id","a" + eventnr);
  eventaudio.attr("name","a" + eventnr);
  eventaudio.attr("value",myObj.events[eventnr].audionr);

// eventpreani
  var eventpreani = template.find("#v");
  eventpreani.attr("id","v" + eventnr);
  eventpreani.attr("name","v" + eventnr);
  eventpreani.attr("value",myObj.events[eventnr].preani);

// eventpostani
  var eventpostani = template.find("#n");
  eventpostani.attr("id","n" + eventnr);
  eventpostani.attr("name","n" + eventnr);
  eventpostani.attr("value", myObj.events[eventnr].postani);

// eventintervall
  var eventintervall = template.find("#i");
  eventintervall.attr("id","i" + eventnr);
  eventintervall.attr("name","i" + eventnr);
  eventintervall.attr("value",myObj.events[eventnr].intervall);
  
//Löschbutton
  var eventdel = template.find("#eventdel");
  eventdel.attr("id","eventdel_" + eventnr);
  eventdel.click(function(){
  template.empty();
  anzevents--;
  $("#eventadd").show();
//  console.log("anzevents:" + anzevents);
  })
  $ (template).appendTo( "#oben" );
  
  $("#v" + eventnr + " option[value='" + myObj.events[eventnr].preani + "']").attr('selected',true);
  $("#n" + eventnr + " option[value='" + myObj.events[eventnr].postani + "']").attr('selected',true);
//  document.getElementById("v" + eventnr).val = myObj.events[eventnr].preani;
//  document.getElementById("n" + eventnr).val = myObj.events[eventnr].postani;
}

});


// neues Event
$("#eventadd").click(function(){
  var template = $("#eventTemplate").clone();
  template.attr("id", "event_group_" + eventnummer);
//eventtext
  var eventtext = template.find("#t");
  eventtext.attr("id","t" + eventnummer);
  eventtext.attr("name","t" + eventnummer);
  eventtext.attr("value","Event" + eventnummer);

// eventdatum
  var eventdatum = template.find("#d");
  var n1 = eventdatum.attr("id","d" + eventnummer);
  eventdatum.attr("name","d" + eventnummer);
  eventdatum.attr("value","2000-01-01");
  eventdatum = template.find("#d");
  //console.log(n1.toString());

// eventstart
// s1
  var eventstart1 = template.find('#s1')
  eventstart1.attr("id","s1" + eventnummer);
  eventstart1.attr("name","s" + eventnummer);
  eventstart1.attr("value", "1");
  eventstart1.attr("checked", true);

  // s2
  var eventstart2 = template.find('#s2')
  eventstart2.attr("id","s2" + eventnummer);
  eventstart2.attr("name","s" + eventnummer);
  eventstart2.attr("value", "2");
  eventstart2.attr("checked", false);

  // s3
  var eventstart3 = template.find('#s3')
  eventstart3.attr("id","s3" + eventnummer);
  eventstart3.attr("name","s" + eventnummer);
  eventstart3.attr("value", "3");
  eventstart3.attr("checked", false);

// eventcolor
  var eventcolor = template.find("#c");
  eventcolor.attr("id","c" + eventnummer);
  eventcolor.attr("name","c" + eventnummer);
  eventcolor.attr("value","#ffffff");

// eventaudio
  var eventaudio = template.find("#a");
  eventaudio.attr("id","a" + eventnummer);
  eventaudio.attr("name","a" + eventnummer);

// eventpreani
  var eventpreani = template.find("#v");
  eventpreani.attr("id","v" + eventnummer);
  eventpreani.attr("name","v" + eventnummer);

// eventpostani
  var eventpostani = template.find("#n");
  eventpostani.attr("id","n" + eventnummer);
  eventpostani.attr("name","n" + eventnummer);

// eventintervall
  var eventintervall = template.find("#i");
  eventintervall.attr("id","i" + eventnummer);
  eventintervall.attr("name","i" + eventnummer);

//Löschbutton
var eventdel = template.find("#eventdel");
eventdel.attr("id","eventdel_" + eventnummer);
eventdel.click(function(){
  template.empty();
  anzevents--;
  $("#eventadd").show();
  //console.log("anzevents:" + anzevents);
})

$ (template).appendTo( "#oben" );
anzevents++;
eventnummer++;
if ( anzevents >= maxevents ) $("#eventadd").hide();
  // console.log("anzevents:" + anzevents);
}); 


</script>


</body></html>